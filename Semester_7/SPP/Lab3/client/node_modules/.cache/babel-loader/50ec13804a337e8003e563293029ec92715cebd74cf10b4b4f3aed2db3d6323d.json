{"ast":null,"code":"import { jwtDecode } from \"jwt-decode\";\nimport { constants } from \"./constants\";\n\n//Return true if update by refresh token was redundant or successful, false otherwise\nasync function updateTokensIfAccessExpired() {\n  const possibleAccessToken = localStorage.getItem('accessToken');\n  if (possibleAccessToken && Date.now() / 1000 >= jwtDecode(possibleAccessToken).exp) {\n    const response = await fetch('/users/refresh', {\n      method: 'POST',\n      credentials: 'include'\n    });\n    if (response.status === 401) {\n      return false;\n    } else {\n      const data = await response.json();\n      localStorage.setItem('accessToken', data.accessToken);\n    }\n  }\n  return true;\n}\n\n//setActive - function from useState hook to switch components\nexport async function authFetch(setActive, url, options = {}) {\n  if (!(await updateTokensIfAccessExpired())) {\n    setActive(constants.loginContainer);\n  }\n  const headers = {\n    ...options.headers,\n    'Authorization': `Bearer ${localStorage.getItem('accessToken')}`,\n    credentials: 'include'\n  };\n  const response = await fetch(url, {\n    ...options,\n    headers\n  });\n}","map":{"version":3,"names":["jwtDecode","constants","updateTokensIfAccessExpired","possibleAccessToken","localStorage","getItem","Date","now","exp","response","fetch","method","credentials","status","data","json","setItem","accessToken","authFetch","setActive","url","options","loginContainer","headers"],"sources":["D:/Labs/semester_7/SPP/Lab3/client/src/utils/authFetch.js"],"sourcesContent":["import {jwtDecode} from \"jwt-decode\";\r\nimport {constants} from \"./constants\";\r\n\r\n//Return true if update by refresh token was redundant or successful, false otherwise\r\nasync function updateTokensIfAccessExpired() {\r\n    const possibleAccessToken = localStorage.getItem('accessToken');\r\n    if (possibleAccessToken && (Date.now() / 1000 >= jwtDecode(possibleAccessToken).exp)) {\r\n        const response = await fetch('/users/refresh', {\r\n            method: 'POST',\r\n            credentials: 'include'\r\n        });\r\n        if (response.status === 401) {\r\n            return false;\r\n        } else {\r\n            const data = await response.json();\r\n            localStorage.setItem('accessToken', data.accessToken);\r\n        }\r\n    }\r\n    return true;\r\n}\r\n\r\n//setActive - function from useState hook to switch components\r\nexport async function authFetch(setActive, url, options = {}) {\r\n    if (!(await updateTokensIfAccessExpired())) {\r\n        setActive(constants.loginContainer);\r\n    }\r\n\r\n    const headers = {\r\n        ...options.headers,\r\n        'Authorization': `Bearer ${localStorage.getItem('accessToken')}`,\r\n        credentials: 'include'\r\n    };\r\n\r\n    const response = await fetch(url, {\r\n        ...options,\r\n        headers\r\n    });\r\n\r\n    \r\n}"],"mappings":"AAAA,SAAQA,SAAS,QAAO,YAAY;AACpC,SAAQC,SAAS,QAAO,aAAa;;AAErC;AACA,eAAeC,2BAA2BA,CAAA,EAAG;EACzC,MAAMC,mBAAmB,GAAGC,YAAY,CAACC,OAAO,CAAC,aAAa,CAAC;EAC/D,IAAIF,mBAAmB,IAAKG,IAAI,CAACC,GAAG,CAAC,CAAC,GAAG,IAAI,IAAIP,SAAS,CAACG,mBAAmB,CAAC,CAACK,GAAI,EAAE;IAClF,MAAMC,QAAQ,GAAG,MAAMC,KAAK,CAAC,gBAAgB,EAAE;MAC3CC,MAAM,EAAE,MAAM;MACdC,WAAW,EAAE;IACjB,CAAC,CAAC;IACF,IAAIH,QAAQ,CAACI,MAAM,KAAK,GAAG,EAAE;MACzB,OAAO,KAAK;IAChB,CAAC,MAAM;MACH,MAAMC,IAAI,GAAG,MAAML,QAAQ,CAACM,IAAI,CAAC,CAAC;MAClCX,YAAY,CAACY,OAAO,CAAC,aAAa,EAAEF,IAAI,CAACG,WAAW,CAAC;IACzD;EACJ;EACA,OAAO,IAAI;AACf;;AAEA;AACA,OAAO,eAAeC,SAASA,CAACC,SAAS,EAAEC,GAAG,EAAEC,OAAO,GAAG,CAAC,CAAC,EAAE;EAC1D,IAAI,EAAE,MAAMnB,2BAA2B,CAAC,CAAC,CAAC,EAAE;IACxCiB,SAAS,CAAClB,SAAS,CAACqB,cAAc,CAAC;EACvC;EAEA,MAAMC,OAAO,GAAG;IACZ,GAAGF,OAAO,CAACE,OAAO;IAClB,eAAe,EAAE,UAAUnB,YAAY,CAACC,OAAO,CAAC,aAAa,CAAC,EAAE;IAChEO,WAAW,EAAE;EACjB,CAAC;EAED,MAAMH,QAAQ,GAAG,MAAMC,KAAK,CAACU,GAAG,EAAE;IAC9B,GAAGC,OAAO;IACVE;EACJ,CAAC,CAAC;AAGN","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}